{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MonitorComponent = void 0;\nconst ng_components_1 = require(\"@po-ui/ng-components\");\nconst interfaces_1 = require(\"../utilities/interfaces\");\nconst _constants = require(\"../utilities/constants-angular\");\nconst operators_1 = require(\"rxjs/operators\");\nconst i0 = require(\"@angular/core\");\nconst i1 = require(\"./monitor-service\");\nconst i2 = require(\"ngx-electronyzer\");\nconst i3 = require(\"@po-ui/ng-components\");\nconst _c0 = [\"modal_1\"];\nconst _c1 = [\"modal_2\"];\nlet MonitorComponent = /*#__PURE__*/(() => {\n  class MonitorComponent {\n    constructor(_monitorService, _electronService, thfNotification) {\n      this._monitorService = _monitorService;\n      this._electronService = _electronService;\n      this.thfNotification = thfNotification;\n      this.details = new interfaces_1.AgentLog();\n      this.agentLog = [];\n      this.showModalMonitor = false;\n      this.setTableRowActions = [{\n        action: this.modal_1_open.bind(this),\n        icon: 'po-icon-info',\n        label: 'Detalhes'\n      }];\n      this.setColumns = [{\n        property: 'status',\n        type: 'subtitle',\n        width: '10%',\n        subtitles: [{\n          value: _constants.CNST_LOGLEVEL.INFO.level,\n          color: 'success',\n          label: 'Finalizado',\n          content: ''\n        }, {\n          value: _constants.CNST_LOGLEVEL.WARN.level,\n          color: 'warning',\n          label: 'Em execução',\n          content: ''\n        }, {\n          value: _constants.CNST_LOGLEVEL.ERROR.level,\n          color: 'danger',\n          label: 'Erro',\n          content: ''\n        }, {\n          value: 'C',\n          color: 'color-12',\n          label: 'Cancelado',\n          content: ''\n        }]\n      }, {\n        property: 'scheduleName',\n        label: 'Agendamento',\n        width: '20%'\n      }, {\n        property: 'str_startDate',\n        label: 'Data/hora de início',\n        width: '25%'\n      }, {\n        property: 'str_endDate',\n        label: 'Data/hora de término',\n        width: '25%'\n      }, {\n        property: 'duration',\n        label: 'Tempo de Execução',\n        width: '20%'\n      }];\n      this.setDetailColumns = [{\n        property: 'str_timestamp',\n        label: 'Data/Hora',\n        width: '20%'\n      }, {\n        property: 'loglevel',\n        label: 'Nível',\n        width: '10%'\n      }, {\n        property: 'system',\n        label: 'Origem',\n        width: '10%'\n      }, {\n        property: 'message',\n        label: 'Mensagem',\n        width: '60%'\n      }];\n    }\n    ngOnInit() {\n      setInterval(() => {\n        this.updateMonitorLog().subscribe();\n      }, 60000 * 5);\n      this.updateMonitorLog().subscribe();\n    }\n    updateMonitorLog() {\n      return this._monitorService.getMonitorLog().pipe((0, operators_1.map)(logs => {\n        this.agentLog = logs;\n      }));\n    }\n    modal_1_open(agentLog) {\n      this.details = agentLog;\n      this.modal_1.open();\n    }\n    modal_1_close() {\n      this.details = new interfaces_1.AgentLog();\n      this.modal_1.close();\n    }\n    modal_2_open(execution) {\n      this.idExecutionCancel = execution.idExecution;\n      this.modal_2.open();\n    }\n    modal_2_close() {\n      this.idExecutionCancel = null;\n      this.modal_2.close();\n    }\n    modal_2_confirm() {\n      this.modal_2.close();\n      const changeStatus = this._electronService.ipcRenderer.sendSync('setStatusExecution', this.idExecutionCancel, 'C');\n      if (changeStatus) {\n        this.agentLog = [];\n        //this.agentLog = this._monitorService.getMonitorLog();\n      } else {\n        const thfNotification = {\n          message: 'Houve um erro ao tentar cancelar o status da execução',\n          orientation: ng_components_1.PoToasterOrientation.Top\n        };\n        this.thfNotification.error(thfNotification);\n      }\n    }\n  }\n  MonitorComponent.ɵfac = function MonitorComponent_Factory(t) {\n    return new (t || MonitorComponent)(i0.ɵɵdirectiveInject(i1.MonitorService), i0.ɵɵdirectiveInject(i2.ElectronService), i0.ɵɵdirectiveInject(i3.PoNotificationService));\n  };\n  MonitorComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: MonitorComponent,\n    selectors: [[\"app-monitor\"]],\n    viewQuery: function MonitorComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n        i0.ɵɵviewQuery(_c1, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.modal_1 = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.modal_2 = _t.first);\n      }\n    },\n    decls: 15,\n    vars: 8,\n    consts: [[\"p-title\", \"Monitor de Execu\\u00E7\\u00E3o\"], [\"p-container\", \"shadow\", \"p-sort\", \"true\", \"p-striped\", \"true\", \"p-hide-columns-manager\", \"true\", \"p-infinite-scroll\", \"true\", 1, \"executions\", 3, \"p-columns\", \"p-actions\", \"p-actions-right\", \"p-items\"], [\"p-click-out\", \"true\", \"p-size\", \"auto\", \"p-title\", \"Detalhes da Execu\\u00E7\\u00E3o\"], [\"modal_1\", \"\"], [1, \"details\"], [\"p-infinite-scroll\", \"true\", \"p-hide-columns-manager\", \"true\", 1, \"gridDetails\", 3, \"p-items\", \"p-columns\"], [1, \"modal-footer\"], [1, \"po-row\", \"footer\"], [\"p-label\", \"Voltar\", \"p-kind\", \"primary\", 3, \"p-click\"], [\"p-title\", \"Deseja realmente alterar o status da execu\\u00E7\\u00E3o para cancelado?\", 3, \"p-primary-action\", \"p-secondary-action\"], [\"modal_2\", \"\"], [\"p-label\", \"N\\u00E3o\", 3, \"p-click\"], [\"p-label\", \"Sim\", \"p-kind\", \"primary\", 3, \"p-click\"]],\n    template: function MonitorComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"po-page-list\", 0);\n        i0.ɵɵelement(1, \"po-table\", 1);\n        i0.ɵɵelementStart(2, \"po-modal\", 2, 3)(4, \"div\", 4);\n        i0.ɵɵelement(5, \"po-table\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"po-modal-footer\", 6)(7, \"div\", 7)(8, \"po-button\", 8);\n        i0.ɵɵlistener(\"p-click\", function MonitorComponent_Template_po_button_p_click_8_listener() {\n          return ctx.modal_1_close();\n        });\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(9, \"po-modal\", 9, 10)(11, \"po-modal-footer\", 6)(12, \"div\", 7)(13, \"po-button\", 11);\n        i0.ɵɵlistener(\"p-click\", function MonitorComponent_Template_po_button_p_click_13_listener() {\n          return ctx.modal_2_close();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"po-button\", 12);\n        i0.ɵɵlistener(\"p-click\", function MonitorComponent_Template_po_button_p_click_14_listener() {\n          return ctx.modal_2_confirm();\n        });\n        i0.ɵɵelementEnd()()()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"p-columns\", ctx.setColumns)(\"p-actions\", ctx.setTableRowActions)(\"p-actions-right\", true)(\"p-items\", ctx.agentLog);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"p-items\", ctx.details.messages)(\"p-columns\", ctx.setDetailColumns);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"p-primary-action\", ctx.modal_2_confirm)(\"p-secondary-action\", ctx.modal_2_close);\n      }\n    },\n    dependencies: [i3.PoPageListComponent, i3.PoTableComponent, i3.PoModalComponent, i3.PoModalFooterComponent, i3.PoButtonComponent],\n    styles: [\"div.details[_ngcontent-%COMP%]{width:auto;height:740px;border-style:none;padding:4px}\"]\n  });\n  return MonitorComponent;\n})();\nexports.MonitorComponent = MonitorComponent;","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}